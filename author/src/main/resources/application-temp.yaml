# # ğŸ“‚ 1. ê³µí†µ
# server:
#   port: 8080

# spring:
#   application.name: author
#   h2.console.enabled: true
#   h2.console.path: /h2-console

#   datasource:
#     url: jdbc:h2:mem:testdb
#     driverClassName: org.h2.Driver
#     username: sa

#   jpa:
#     hibernate.ddl-auto: update
#     show-sql: true
#     properties.hibernate.format_sql: true

#   cloud.stream:
#     default-binder: kafka
#     bindings:
#       authorRequested-out-0.destination: author.registration.requested
#       authorApproved-out-0.destination: author.registration.approved
#       authorRejected-out-0.destination: author.registration.rejected
#     kafka.binder.configuration.enable.idempotence: true

# ---
# # ğŸ“ 2. ë¡œì»¬(default)
# spring:
#   config.activate.on-profile: default
#   kafka.bootstrap-servers: localhost:9092
#   cloud.stream.kafka.binder.brokers: localhost:9092

# ---
# # ğŸ³ 3. ì»¨í…Œì´ë„ˆ(docker)
# spring:
#   config:
#     activate:
#       on-profile: docker
#   kafka.bootstrap-servers: my-kafka:9092
#   cloud.stream.kafka.binder.brokers: my-kafka:9092

server:
  port: 8080
 
---
# 'default' í”„ë¡œí•„ ì„¤ì • (ë¡œì»¬ ê°œë°œ í™˜ê²½)
spring:
  config:
    activate:
      on-profile: default
 
  # --- ì´ ë¶€ë¶„ì„ ìƒˆë¡œ ì¶”ê°€í•˜ê±°ë‚˜, ê¸°ì¡´ datasource/h2 ì„¤ì •ì„ êµì²´í•©ë‹ˆë‹¤ ---
  h2:
    console:
      enabled: true           # H2 ì½˜ì†” ê¸°ëŠ¥ì„ ì¼­ë‹ˆë‹¤.
      path: /h2-console       # ì½˜ì†” ì ‘ì† ê²½ë¡œì…ë‹ˆë‹¤.
  datasource:
    url: jdbc:h2:mem:bookdb   # book ì„œë¹„ìŠ¤ì˜ DBì— 'bookdb'ë¼ëŠ” ê³ ì •ëœ ì´ë¦„ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
    driverClassName: org.h2.Driver
    username: sa
    password:
  # ---------------------------------------------------------------------
 
  jpa:
    properties:
      hibernate:
        show_sql: true
        format_sql: true
    hibernate:
      ddl-auto: update # ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ Entityì— ë§ì¶° í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ë³€ê²½/ìƒì„±
 
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: author-service
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.example.author.event.*"
    listener:
      missing-topics-fatal: false   # í† í”½ì´ ì•„ì§ ì—†ì„ ë•Œ ì˜¤ë¥˜ ë°©ì§€

  cloud:
    stream:
      default-binder: kafka
      bindings:
        authorRequested-out-0:
          destination: author.registration.requested
        authorApproved-out-0:
          destination: author.registration.approved
        authorRejected-out-0:
          destination: author.registration.rejected
      kafka:
        binder:
          brokers: localhost:9092
          configuration:
            enable.idempotence: true
 
---


spring:
  config:
    activate:
      on-profile: docker   # ë˜ëŠ” "k8s", "prod" ë“± ì¿ ë²„ë„¤í‹°ìŠ¤ ì „ìš© í”„ë¡œí•„

  h2:
    console:
      enabled: true
      path: /h2-console
  datasource:
    url: jdbc:h2:mem:bookdb
    driverClassName: org.h2.Driver
    username: sa
    password:

  jpa:
    properties:
      hibernate:
        show_sql: true
        format_sql: true
    hibernate:
      ddl-auto: update

  kafka:
    bootstrap-servers: my-kafka:9092   # ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ìš© Kafka ì„œë¹„ìŠ¤ ì£¼ì†Œ
    consumer:
      group-id: author-service
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.example.author.event.*"
    listener:
      missing-topics-fatal: false

  cloud:
    stream:
      default-binder: kafka
      bindings:
        authorRequested-out-0:
          destination: author.registration.requested
        authorApproved-out-0:
          destination: author.registration.approved
        authorRejected-out-0:
          destination: author.registration.rejected
      kafka:
        binder:
          brokers: my-kafka:9092
          configuration:
            enable.idempotence: true

  # cloud:
  #   function:
  #     definition: bookEventConsumer;wheneverBookAccessChecked_Route
  #   stream:
  #     default-binder: kafka
  #     bindings:
  #       authorRequested-out-0.destination: author.registration.requested
  #       authorApproved-out-0.destination: author.registration.approved
  #       authorRejected-out-0.destination: author.registration.rejected
  #     kafka.binder.configuration.enable.idempotence: true
  #     kafka:
  #       binder:
  #         brokers: my-kafka:9092